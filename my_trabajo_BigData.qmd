---
title: "AN√ÅLISIS DE LOS 10 √ÅLBUMES DE TAYLOR SWIFT"
description: |
  Un repaso por las distintas eras de la artista
author:
  - name: Ana Royo S√°nchez
    affiliation: Universitat de Val√®ncia
    affiliation-url: https://www.uv.es
date: 2024-01-24
categories: [trabajo BigData, musica, Taylor Swift]
image: "./imagenes/imagen_01.png"
title-block-banner: true
title-block-banner-color: "#FFE7FC"
toc: true
toc-location: left
toc-depth: 3
smooth-scroll: true
format: 
  html:
    backgroundcolor: "#FFE7FC"
    embed-resources: true
    link-external-newwindow: true
    #css: ./assets/my_css_file.css
code-tools: true
code-link: true
---

## Introducci√≥n

En el panorama musical contempor√°neo, pocas figuras han ejercido un impacto tan profundo y sostenido como **Taylor Swift**. Desde su debut en la escena musical hasta la actualidad, ha evolucionado de manera notable no solo como artista, sino tambi√©n como narradora magistral de historias a trav√©s de su m√∫sica. Taylor lleva casi **dos d√©cadas de carrera musical**, la cual ha dividido en **10 eras distintas** (cada una correspondiente a un √°lbum espec√≠fico) que recogen diferentes sonidos, sentimientos y momentos vitales.

![Ilustraci√≥n de las 10 eras de Taylor Swift](./imagenes/eras.jpg)
---

## Datos

### Obtenemos los datos


::: {.panel-tabset}

## Datos

Los datos que vamos a utilizar para el trabajo han sido extra√≠dos de [Kaggle](https://www.kaggle.com/), una plataforma web que re√∫ne la comunidad Data Science m√°s grande del mundo. El conjunto de datos consta de datos de la API de Spotify para todos sus √°lbumes.

## Paquetes

```{r}
library(tidyr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(plotly)
library(knitr)
library(kableExtra)
library(gridExtra)
library(rio)
library(scales)
library(stringr)
library(tidytext)
library(lubridate)
library(gganimate)
library(gt)
library(gtExtras)
library(RColorBrewer)
```

:::

Los datos se pueden cargar en la memoria de R/RStudio de esta forma:

```{r}
archivo_destino <- here::here("datos", "taylor_swift_spotify.xlsx")
spotify <- rio::import(archivo_destino)

lyrics <- rio::import(here::here("datos", "taylor_swift_lyrics.xlsx"))

concerts <- rio::import(here::here("datos", "taylor_swift_concerts.xlsx"))
```

Hemos importado tres conjuntos de datos para analizar. El primer dataset contiene observaciones sobre un conjunto de `r nrow(spotify)` canciones. Disponemos de `r ncol(spotify)` variables a analizar sobre dichas canciones. En el segundo, lo que encontramos son las letras de las canciones. El √∫ltimo dataset contiene informaci√≥n sobre las giras de conciertos.

Por tanto, en primer lugar realizaremos un an√°lisis sobre las propias canciones y los √°lbumes a los que pertenecen, para posteriormente centrarnos en los *lyrics* y lo que pretende transmitir Taylor. Terminaremos con un peque√±o an√°lisis sobre la recaudaci√≥n de cada *tour*.

---

### Arreglamos y transformamos los datos

Para poder analizar los datos y hacer gr√°ficos chulos, antes es necesario arreglar dichos datos.

En primer lugar, elegimos las columnas con las que queremos trabajar, en este caso queremos: nombre de la canci√≥n, √°lbum, fecha, duraci√≥n, popularidad y todas las caracter√≠sticas de las canciones como bailabilidad, vivacidad, volumen, etc.

Despu√©s, para que resulte m√°s f√°cil saber de qu√© √°lbum estamos hablando, puesto que sabemos que Taylor ha regrabado algunos de sus √°lbumes (Taylor's Version) y ha lanzado algunas ediciones diferentes, como versiones deluxe y tambi√©n √°lbumes de conciertos, vamos a crear una nueva columna con el nombre del √°lbum independientemente de la versi√≥n.

Por √∫ltimo, ya que cada era tiene una est√©tica diferente, vamos a asignar a cada uno de los √°lbumes su color caracter√≠stico para que se vea posteriormente en los gr√°ficos.

```{r}
spotify <- spotify %>%
  select('name', 'album', 'release_date', 'track_number', 'acousticness', 'danceability', 'energy', 'instrumentalness', 'liveness', 'loudness', 'speechiness', 'tempo', 'valence', 'popularity', 'duration_ms')

spotify <- spotify %>%
  mutate(album_new = case_when(str_detect(album, "Speak Now") ~ "Speak Now",
                               str_detect(album, "Midnights") ~ "Midnights",
                               str_detect(album, "Red") ~ "Red",
                               str_detect(album, "Fearless") ~ "Fearless",
                               str_detect(album, "evermore") ~ "evermore",
                               str_detect(album, "folklore") ~ "folklore",
                               str_detect(album, "Lover") ~ "Lover",
                               str_detect(album, "reputation") ~ "reputation",
                               str_detect(album, "1989") ~ "1989",
                               str_detect(album, "Taylor Swift") ~ "Taylor Swift",
                               TRUE ~ 'Others'))

spotify <- spotify[!grepl("Live|Stadium|session", c(spotify$album)),]

#- creamos la paleta de colores de sus √°lbumes
colors <- c("Taylor Swift" = "seagreen3",
            "Fearless" = "goldenrod1",
            "Speak Now" = "orchid3",
            "Red" = "red3",
            "1989"= "skyblue3",
            "reputation" = "gray15",
            "Lover" = "hotpink",
            "folklore" = "lavenderblush4",
            "evermore"= "burlywood",
            "Midnights" = "midnightblue",
            "Others" = "salmon1" )
```

---

## An√°lisis de canciones

### Canciones m√°s populares de su discograf√≠a


Comenzamos nuestro an√°lisis viendo cu√°les son las canciones m√°s populares de toda la discograf√≠a de Taylor Swift. En la siguiente tabla se presenta un resumen del **TOP 10 canciones**. Cada entrada incluye el nombre de la canci√≥n, el √°lbum al que pertenece y su nivel de popularidad en la plataforma de Spotify.

Esta clasificaci√≥n proporciona una instant√°nea de sus canciones m√°s aclamadas, destacando √©xitos notables que han resonado significativamente con el p√∫blico. La columna "Popularidad" refleja la calificaci√≥n relativa de cada canci√≥n en funci√≥n de su recepci√≥n y reproducciones en Spotify.


```{r}
popular_songs <- spotify %>%
  arrange(desc(popularity)) %>% 
  slice(1:10) %>% 
  select(name, album_new, popularity)
colnames(popular_songs) <- c("Nombre de la canci√≥n", "√Ålbum", "Popularidad")

popular_songs_table <- knitr::kable(popular_songs, format = "html", row.names = FALSE) %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  add_header_above(c("TOP 10 CANCIONES M√ÅS POPULARES DE TAYLOR SWIFT" = 3), font_size = 20) %>%
  kableExtra::column_spec(c(1, 2, 3), width = "60%")

popular_songs_table
```

Aqu√≠ ten√©is la canci√≥n que ocupa la primera posici√≥n, por si quereis escucharla mientras segu√≠s leyendo el trabajo ;)

```{r}
#| code-fold: true
library("vembedr")
embed_url("https://www.youtube.com/watch?v=ic8j13piAhQ")
```

---

### Popularidad de las canciones por √°lbum


En el siguiente **gr√°fico de cajas (boxplot)**, exploramos la distribuci√≥n de la popularidad de las canciones de Taylor Swift a lo largo del tiempo, organizadas por √°lbum. Cada caja representa la variabilidad intercuart√≠lica (IQR) de la popularidad de las canciones dentro de un √°lbum espec√≠fico, mientras que la l√≠nea central en cada caja representa la mediana.

Observamos c√≥mo la popularidad de las canciones ha evolucionado a lo largo de los distintos lanzamientos, reflejando la diversidad en el recibimiento de cada √°lbum. La paleta de colores √∫nica asignada a cada √°lbum facilita la identificaci√≥n visual de las tendencias y diferencias en la distribuci√≥n. Al analizar este gr√°fico, podemos diferenciar patrones y momentos destacados en la carrera musical de Taylor Swift.


```{r}
spotify$album_new <- factor (spotify$album_new, levels = unique(spotify$album_new[order(spotify$release_date)]))  #- ordenamos por fecha de lanzamiento

ggplot(spotify, aes(x = release_date, y = popularity)) + 
  geom_boxplot(aes(color = album_new), outlier.shape = NA) +
  geom_point(aes(color = album_new), position = position_jitter(width = 0.2), alpha = 0.5) +
  scale_color_manual(values = colors) +
  theme_minimal() + 
  theme(axis.text.x = element_text(vjust = 0.5, hjust = 1),
        axis.title = element_text(size = 10),
        plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
        plot.caption = element_text(size = 8),
        legend.position = "bottom",
        legend.box.background = element_rect(color = "black", size = 0.5),
        panel.background = element_rect(fill = "honeydew", color = "white", linetype = "solid"),
        plot.margin = margin(10, 10, 10, 10)) +
  labs(title = "Distribuci√≥n de Popularidad de las Canciones por √Ålbum",
       x = "Fecha de lanzamiento",
       y = "Popularidad",
       color = "√Ålbum",
       caption = "Fuente: Datos de Spotify") +
  geom_hline(yintercept = median(spotify$popularity), linetype = "dashed", color = "black", size = 0.5) +
  geom_text(data = subset(spotify, !duplicated(album_new, fromLast = TRUE)),
            aes(x = release_date, y = popularity, label = album_new),
            color = "black", vjust = -0.5, hjust = -0.2, size = 2.5)
```

Podemos observar que la popularidad de Taylor ha aumentado considerablemente desde *1989* hasta *Lover*. Tras este √°lbum, vemos una peque√±a ca√≠da que puede explicarse por su cambio de estilo en los dos siguientes √°lbumes: *folklore* y *evermore*. Sin embargo, despu√©s de eso mantiene un nivel de popularidad bastante estable.

---

### Evoluci√≥n temporal de la popularidad


Para que sea m√°s visual y m√°s f√°cil distinguir cu√°l ha sido realmente la evoluci√≥n de la popularidad de las canciones de Taylor, creamos el siguiente **gr√°fico animado**. Cada l√≠nea representa la trayectoria de popularidad de las canciones de cada √°lbum a medida que transcurren los a√±os.


```{r}
spotify_filtered <- spotify %>%
  filter(album_new != "Taylor Swift",
         album_new != "Midnights")

p <- ggplot(spotify_filtered, aes(x = release_date, y = popularity, color = album_new)) +
  geom_line(size = 1) +
  labs(title = "Evoluci√≥n Temporal de la Popularidad por √Ålbum",
       x = "A√±o",
       y = "Popularidad",
       color = "√Ålbum") +
  theme_minimal() + 
  theme(legend.position = "bottom",
        axis.text.x = element_text(hjust = 1, size = 8),
        plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
        axis.title.x = element_text(size = 10, hjust = 1, vjust = 0),
        axis.title.y = element_text(size = 10, hjust = 0.5, vjust = 1),
        legend.title = element_text(face = "bold"),
        panel.grid.major = element_line(colour = "gray87", linetype = "dashed"),
        panel.background = element_rect(fill = "honeydew"),
        panel.grid.minor = element_blank(),
        axis.text = element_text(size = 9, colour = "gray17")) + 
  scale_color_manual(values = colors) +
  geom_text(aes(label = album_new), nudge_x = 0.5, nudge_y = 0.5, hjust = 0)

#- animamos el gr√°fico
p_animated <- p + transition_reveal(release_date) +
  enter_fade() + 
  exit_fade()

animate(p_animated, nframes = 200, fps = 20)
```

---

### Duraci√≥n de las canciones por √°lbum


El siguiente **gr√°fico de barras** muestra la duraci√≥n promedio de las canciones de Taylor Swift en funci√≥n de los distintos √°lbumes, los cuales aparecen ordenados de mayor a menor duraci√≥n. Bas√°ndonos en un an√°lisis de **426 canciones**, las agrupamos por √°lbum y obtenemos el promedio de duraci√≥n en minutos para cada uno de ellos.

Como veremos a continuaci√≥n, el √°lbum *Speak Now* destaca con la duraci√≥n promedio m√°s larga, de 4.71 minutos por canci√≥n. En contraste, el √°lbum *Lover* se destaca por su estilo m√°s conciso y directo ya que sus canciones presentan una duraci√≥n promedio m√°s corta, concretamente de 3,44 minutos por canci√≥n.


```{r}
average_duration_by_album <- spotify %>%
  group_by(album_new) %>%
  summarise(average_duration = mean(duration_ms))

average_duration_by_album$average_duration_minutes <- average_duration_by_album$average_duration / 60000  #- pasamos la duraci√≥n media a minutos

ggplot(average_duration_by_album, aes(x = reorder(album_new, -average_duration), y = average_duration_minutes, fill = album_new)) +
  geom_bar(stat = "identity", color = "black", size = 0.5, position = "stack") +
  geom_text(aes(label = sprintf("%.2f", average_duration_minutes)),
            position = position_stack(vjust = 0.5), size = 3, color = "black") +
  scale_fill_manual(values = colors) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
        legend.position = "none",
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(color = "black")) +
  labs(title = "Duraci√≥n Media de las Canciones por √Ålbum",
       subtitle = "Basado en 426 canciones de Taylor Swift",
       x = "√Ålbum",
       y = "Duraci√≥n promedio (minutos)",
       caption = "Fuente: Datos de Spotify") +
  theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 10, hjust = 0.5),
        plot.caption = element_text(size = 8, hjust = 0.5),
        axis.title.y = element_text(size = 10, vjust = 1),
        axis.title.x = element_text(size = 10),
        axis.text.x = element_text(size = 8),
        axis.text.y = element_text(size = 8, vjust = -0.5, color = "black"),
        axis.line.x = element_line(color = "black", linewidth = 0.5),
        plot.margin = margin(10, 10, 10, 10))
```

---

### Caracter√≠sticas musicales de los √°lbumes


En este conjunto de visualizaciones exploramos diversas caracter√≠sticas musicales de las canciones de Taylor Swift a lo largo de sus √°lbumes. Cada gr√°fico proporciona una perspectiva √∫nica sobre c√≥mo estas caracter√≠sticas han evolucionado a lo largo de su carrera. Las caracter√≠sticas analizadas incluyen:

- **Danceability**: Muestra la variabilidad en la capacidad de las canciones para inspirar movimiento y baile. Valores m√°s altos indican canciones m√°s propicias para el baile.

- **Energy**: Representa la intensidad y actividad percibida en las canciones. Un mayor valor sugiere canciones m√°s en√©rgicas.

- **Acousticness**: Explora la presencia de elementos ac√∫sticos en las canciones. Valores altos indican un sonido m√°s cercano a lo ac√∫stico.

- **Loudness**: Refleja el volumen general de las canciones. Valores m√°s altos indican canciones m√°s fuertes.


::: {.panel-tabset}

## Danceability

```{r}
#| code-fold: true
plot_danceability <- ggplot(spotify, aes(x = album_new, y = danceability, fill = album_new)) +
  geom_violin(trim = FALSE, alpha = 0.8) +  #- ajustamos la transparencia para mejor visualizaci√≥n
  geom_boxplot(width = 0.2, fill = "white", color = "black", outlier.shape = NA) +  #- eliminamos outliers en el boxplot
  scale_fill_manual(values = colors) +
  theme_minimal() +
  labs(title = "Variaci√≥n de Danceability entre √Ålbumes",
       subtitle = "Comparaci√≥n de la bailabilidad a lo largo de las eras",
       x = "√Ålbum",
       y = "Danceability",
       fill = "√Ålbum",
       caption = "Fuente: Datos de Spotify") +
  theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 10, hjust = 0.5, color = "gray"),
        plot.caption = element_text(size = 8),
        legend.position = "none",
        axis.title.y = element_text(size = 10, vjust = 1),
        axis.title.x = element_text(size = 10),
        axis.text.x = element_text(angle = 45, size = 8, hjust = 1, vjust = 1),
        axis.text.y = element_text(size = 8, vjust = -0.5, color = "black"),
        panel.background = element_rect(fill = "honeydew", color = "white", linetype = "solid"),
        plot.margin = margin(10, 10, 10, 10))

print(plot_danceability)
```

## Energy

```{r}
#| code-fold: true
plot_energy <- ggplot(spotify, aes(x = album_new, y = energy, fill = album_new)) +
  geom_violin(trim = FALSE, alpha = 0.8) +
  geom_boxplot(width = 0.2, fill = "white", color = "black", outlier.shape = NA) +
  scale_fill_manual(values = colors) +
  theme_minimal() +
  labs(title = "Variaci√≥n de Energy entre √Ålbumes",
       subtitle = "Comparaci√≥n de la energ√≠a a lo largo de las eras",
       x = "√Ålbum",
       y = "Energy",
       fill = "√Ålbum",
       caption = "Fuente: Datos de Spotify") +
  theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 10, hjust = 0.5, color = "gray"),
        plot.caption = element_text(size = 8),
        legend.position = "none",
        axis.title.y = element_text(size = 10, vjust = 1),
        axis.title.x = element_text(size = 10),
        axis.text.x = element_text(angle = 45, size = 8),
        axis.text.y = element_text(size = 8, vjust = -0.5, color = "black"),
        panel.background = element_rect(fill = "honeydew", color = "white", linetype = "solid"),
        plot.margin = margin(10, 10, 10, 10))

print(plot_energy)
```

## Acousticness

```{r}
#| code-fold: true
plot_acousticness <- ggplot(spotify, aes(x = album_new, y = acousticness, fill = album_new)) +
  geom_violin(trim = FALSE, alpha = 0.8) +
  geom_boxplot(width = 0.2, fill = "white", color = "black", outlier.shape = NA) +
  scale_fill_manual(values = colors) +
  theme_minimal() +
  labs(title = "Variaci√≥n de Acousticness entre √Ålbumes",
       subtitle = "Comparaci√≥n de la ac√∫stica a lo largo de las eras",
       x = "√Ålbum",
       y = "Acousticness",
       fill = "√Ålbum",
       caption = "Fuente: Datos de Spotify") +
  theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 10, hjust = 0.5, color = "gray"),
        plot.caption = element_text(size = 8),
        legend.position = "none",
        axis.title.y = element_text(size = 10, vjust = 1),
        axis.title.x = element_text(size = 10),
        axis.text.x = element_text(angle = 45, size = 8),
        axis.text.y = element_text(size = 8, vjust = -0.5, color = "black"),
        panel.background = element_rect(fill = "honeydew", color = "white", linetype = "solid"),
        plot.margin = margin(10, 10, 10, 10))

print(plot_acousticness)
```

## Loudness

```{r}
#| code-fold: true
plot_loudness <- ggplot(spotify, aes(x = album_new, y = loudness, fill = album_new)) +
  geom_violin(trim = FALSE, alpha = 0.8) +
  geom_boxplot(width = 0.2, fill = "white", color = "black", outlier.shape = NA) +
  scale_fill_manual(values = colors) +
  theme_minimal() +
  labs(title = "Variaci√≥n de Loudness entre √Ålbumes",
       subtitle = "Comparaci√≥n del volumen a lo largo de las eras",
       x = "√Ålbum",
       y = "Loudness",
       fill = "√Ålbum",
       caption = "Fuente: Datos de Spotify") +
  theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 10, hjust = 0.5, color = "gray"),
        plot.caption = element_text(size = 8),
        legend.position = "none",
        axis.title.y = element_text(size = 10, vjust = 1),
        axis.title.x = element_text(size = 10),
        axis.text.x = element_text(angle = 45, size = 8),
        axis.text.y = element_text(size = 8, vjust = -0.5, color = "black"),
        panel.background = element_rect(fill = "honeydew", color = "white", linetype = "solid"),
        plot.margin = margin(10, 10, 10, 10))

print(plot_loudness)
```

:::

Cada gr√°fico utiliza **violines y diagramas de caja** para proporcionar una visi√≥n completa de la distribuci√≥n de estas caracter√≠sticas a lo largo de los √°lbumes. Se observa c√≥mo estas tendencias pueden relacionarse con la evoluci√≥n estil√≠stica y art√≠stica de Taylor Swift a lo largo del tiempo.

---

## An√°lisis de letras

### ¬øCu√°les son las palabras m√°s repetidas?

En esta secci√≥n del an√°lisis, exploramos las letras de las canciones de Taylor Swift con el objetivo de identificar las palabras m√°s frecuentes a lo largo de sus 10 √°lbumes. Realizamos un procesamiento de texto para eliminar palabras comunes y aquellas que carecen de significado propio y hacemos un recuento de las palabras restantes.

El gr√°fico a continuaci√≥n visualiza las **palabras m√°s destacadas**, representando el n√∫mero de veces que aparecen en las letras de las canciones. Cada barra representa una palabra, y la altura de la barra indica la frecuencia de esa palabra en las letras. Las palabras est√°n ordenadas de mayor a menor frecuencia.


```{r}
tay_tok <- lyrics %>%
  unnest_tokens(word, lyric)

tidy_taylor <- tay_tok %>%
  anti_join(stop_words) #- descartamos palabras no significativas

top_words <- tidy_taylor %>%
  count(word, sort = TRUE) %>%
  filter(n > 70,
         word != "di",
         word != "ooh",
         word != "ey") %>%
  mutate(word = factor(word, levels = rev(unique(word))))

word_plot <- ggplot(top_words, aes(word, n, fill = word)) +
  geom_col(color = "black", linewidth = 0.5) +
  geom_text(aes(label = word), position = position_stack(vjust = 0.8), color = "white", size = 5) +
  scale_fill_brewer(palette = "Set3") +
  theme_minimal() +
  labs(title = "Palabras Frecuentes en las Letras de Taylor Swift",
       subtitle = "Top 8 palabras m√°s repetidas",
       x = "",
       y = "N√∫mero de veces mencionada") +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 10, color = "gray"),
    panel.grid.major.y = element_line(color = "gray", size = 0.2, linetype = "dashed"),
    panel.background = element_rect(fill = "honeydew", color = "white", linetype = "solid"),
    axis.text.x = element_text(size = 8, hjust = 1),
    axis.title.x = element_text(size = 10),
    axis.text.y = element_blank(),
    plot.margin = margin(10, 10, 10, 10)) +
  coord_flip()

print(word_plot)
```

---

### ¬øQu√© sentimiento predomina en cada canci√≥n?


El siguiente gr√°fico visualiza el sentimiento asociado con las canciones de Taylor Swift, clasific√°ndolas en positivas y negativas. Cada barra representa una canci√≥n, con la altura indicando el grado de sentimiento y el color diferenciando los √°lbumes. Las barras est√°n ordenadas por el sentimiento, desde el m√°s positivo hasta el m√°s negativo. El gr√°fico se presenta en un formato de facetas para permitir una comparaci√≥n r√°pida entre diversos √°lbumes de Taylor Swift; en este caso, para que la visualizaci√≥n sea m√°s clara, se muestran solo cuatro √°lbumes: *Fearless*, *Speack Now*, *Red* y *1989*.


```{r}
tay_sentiment <- tidy_taylor %>%
  inner_join(get_sentiments("bing")) %>% 
  count(album, track_title, sentiment) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(sentiment = positive - negative)

albums_a_incluir <- c("Fearless", "Speak Now", "Red", "1989")
tay_sentiment_filtrado <- tay_sentiment %>%
  filter(album %in% albums_a_incluir)

tay_order <- c("Fearless", "Speak Now", "Red", "1989")
tay_sentiment_filtrado$album <- factor(tay_sentiment_filtrado$album, levels = tay_order)

tay_sentiment_filtrado %>%
  ggplot(aes(reorder(track_title, sentiment), sentiment, fill = album)) +
  geom_col(width = 0.8, show.legend = FALSE) +
  facet_wrap(~album, ncol = 2, scales = "free") +
  scale_fill_manual(values = c("lightgoldenrod1", "orchid3", "red3", "skyblue3")) +
  labs(x = NULL,
       y = "Sentimiento",
       title = "Canciones de Taylor Swift Clasificadas por Sentimientos",
       subtitle = "Positividad o negatividad de cada canci√≥n") +
  theme_minimal() +
  theme(plot.title = element_text(size = 11, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = 0.25, color = "gray"),
        axis.text.y = element_text(size = 6.5, color = "grey40", angle = 0),
        axis.title.y = element_text(hjust = 0.5, size = 7, color = "grey40", angle = 0),
        axis.title.x =  element_text(size = 8, color = "grey40"),
        axis.text.x = element_text(size = 6.5, color = "grey40"),
        strip.text = element_text(size = 9, color = "grey40", face = "bold"),
        plot.caption = element_text(size = 7.5, color = "grey40"),
        plot.margin = margin(10, 40, 10, 10),
        panel.background = element_rect(fill = "honeydew", color = "white", linetype = "solid")) +
  coord_flip()
```

Cuando una barra se desliza hacia la parte negativa del gr√°fico, significa que las palabras utilizadas en la letra de esa canci√≥n est√°n vinculadas a **sentimientos negativos** como tristeza, melancol√≠a o desaf√≠o. En cambio, si la barra se eleva hacia la parte positiva, sugiere que las palabras est√°n impregnadas de **emociones positivas** como alegr√≠a, esperanza o amor. Este enfoque visual facilita la comparaci√≥n entre las canciones y permite una comprensi√≥n r√°pida de la evoluci√≥n emocional a lo largo de dichos √°lbumes.

Observamos que ciertas canciones destacan notablemente en este an√°lisis. Por ejemplo, *Tell me why*, *The story of us*, *I knew you were trouble* y *Shake it off* est√°n asociadas con sentimientos m√°s negativos... mientras que *Hey Stephen*, *Enchanted*, *The lucky one* y *This love* destacan en la parte positiva del gr√°fico, por lo que podemos decir que Taylor ha usado palabras m√°s bonitas a la hora de componer estas canciones.

---

## An√°lisis de conciertos

### ¬øCu√°nto se ha recaudado en cada gira?


Por √∫ltimo, para hacer tambi√©n un peque√±o √°nalisis sobre las giras de conciertos asociadas a cada uno de los √°lbumes, se presenta el siguiente **gr√°fico de tarta**. Cada segmento representa una gira espec√≠fica, con sus colores distintivos, y los tama√±os relativos de los segmentos reflejan la recaudaci√≥n acumulada de cada gira. Acompa√±ado por etiquetas que detallan las cifras exactas, este gr√°fico proporciona una perspectiva clara sobre las giras m√°s exitosas en t√©rminos de ingresos a lo largo de la carrera de Taylor Swift.

::: {.panel-tabset}

## Gr√°fico de tarta

```{r}
concerts <- concerts %>%
  filter(revenue != "‚Äî") %>%
  mutate(tour_album = case_when(str_detect(tour, "Fearless_Tour") ~ "Fearless", 
                                str_detect(tour, "Reputation_Stadium_Tour") ~ "Reputation",
                                str_detect(tour, "Speak_Now_World_Tour") ~ "Speak Now",
                                str_detect(tour, "The_1989_World_Tour") ~ "1989",
                                str_detect(tour, "The_Red_Tour") ~ "Red")) %>%
  select('tour_album', 'revenue')

#- limpiamos la columna 'revenue'
concerts$revenue <- gsub(",", "", concerts$revenue)
concerts$revenue <- gsub("\\$", "", concerts$revenue)

#- convertimos la columna 'revenue' a tipo num√©rico
concerts$revenue <- as.numeric(concerts$revenue)

#- agrupamos por 'tour' y sumamos los ingresos
ingresos_totales <- concerts %>%
  group_by(tour_album) %>%
  summarise(ingresos_totales = sum(revenue, na.rm = TRUE)) %>%
  arrange(desc(ingresos_totales))

ingresos_totales$tour_album <- reorder(ingresos_totales$tour_album, ingresos_totales$ingresos_totales)

colores <- c("#FFEC8B", "#EE7AE9", "#FF6A6A", "#8EE5EE", "#C1CDC4")
etiquetas <- scales::dollar_format()(ingresos_totales$ingresos_totales)

ggplot(ingresos_totales, aes(x = "", y = ingresos_totales, fill = tour_album)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  labs(title = "Ingresos Totales por Gira de Conciertos",
       subtitle = "Recaudaci√≥n en d√≥lares",
       fill = NULL) +
  theme_void() +
  theme(legend.position = "bottom",
        plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(size = 10, hjust = 0.5, color = "gray"),
        plot.margin = margin(10, 10, 10, 10)) +
  scale_fill_manual(values = colores) +
  geom_text(aes(label = etiquetas), position = position_stack(vjust = 0.5), color = "white", size = 4)
```

## Tabla

```{r}
colnames(ingresos_totales) <- c("Tour", "Ingresos")
colores <- c("#C1CDC4", "#8EE5EE", "#FF6A6A","#EE7AE9", "#FFEC8B")

tabla_concerts <- gt(ingresos_totales) %>%
  gtExtras::gt_plt_dot(column = "Ingresos", category_column = `Tour`,  
                       max_value = NULL, palette = colores) %>%
  gtExtras::gt_theme_nytimes() %>%
  cols_width(`Tour` ~ px(700), 2 ~ px(150)) %>% 
  tab_header(title = "Giras m√°s exitosas en t√©rminos de ingresos",
             subtitle = "Recaudaci√≥n en d√≥lares")

tabla_concerts
```

:::

Observamos un **incremento constante en los ingresos** desde la gira *Fearless* hasta la gira *Reputation*, que destaca como la m√°s exitosa en t√©rminos de recaudaci√≥n. Estos resultados sugieren un impacto positivo continuo en la popularidad y √©xito comercial de Taylor Swift, evidenciando un aumento significativo en la demanda de sus conciertos con cada nuevo √°lbum lanzado.

---

## Conclusi√≥n

¬°Y as√≠ llegamos al final de este recorrido musical por el universo de Taylor Swift!

Desde sus inicios con el √°lbum "Taylor Swift" hasta las recientes producciones de "Midnights", hemos sido testigos de la extraordinaria evoluci√≥n de esta artista a lo largo de los a√±os. Su autenticidad, versatilidad y conexi√≥n con su audiencia la han llevado a la cima de la industria musical. Y lo m√°s emocionante es que, con Taylor, siempre hay m√°s por venir.

Lo √∫ltimo que sabemos de ella es que est√° recorriendo el mundo con su **THE ERAS TOUR**, una gira en la que pretende recoger lo mejor de cada √°lbum de su carrera. Y eso no es todo, puesto que tambi√©n ha lanzado una pel√≠cula para que quien no haya podido verla en directo, lo haga a trav√©s de la gran pantalla. Os adjunto tr√°iler:


```{r}
#| code-fold: true
library("vembedr")
embed_url("https://www.youtube.com/watch?v=KudedLV0tP0")
```

----------------------

<br>

Con esto acabo mi trabajo para BigData!!üé∂üíñ

<br>

----------------------

<br>

### Informaci√≥n sobre la sesi√≥n

Abajo muestro mi entorno de trabajo y paquetes utilizados

```{r}
#| echo: false
sessioninfo::session_info() %>% 
  details::details(summary = 'current session info') 
```

